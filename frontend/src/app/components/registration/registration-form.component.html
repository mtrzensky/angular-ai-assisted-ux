<h1>Medical Profiling</h1>
<form [formGroup]="form" class="form">
  <div class="form-segment">
    @for (formField of formFields; track formField) {
      @if (formField.type === 'select' && formField.options) {
        <mat-form-field appearance="outline" class="full">
          <mat-label>{{ formField.label }}</mat-label>
          <mat-select [formControlName]="formField.formControlName">
            @for (option of formField.options; track option) {
              <mat-option [value]="option.value">{{ option.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      }

      @if (formField.type === 'text') {
        <mat-form-field appearance="outline" class="full">
          <mat-label>{{ formField.label }}</mat-label>
          <input matInput [formControlName]="formField.formControlName">
        </mat-form-field>
      }

      @if (formField.type === 'number') {
        <mat-form-field appearance="outline" class="full">
          <mat-label>{{ formField.label }}</mat-label>
          <input matInput type="number" [formControlName]="formField.formControlName">
        </mat-form-field>
      }
      
      @if (formField.type === 'textarea') { 
        <mat-form-field appearance="outline" class="full">
          <mat-label>{{ formField.label }}</mat-label>
          <textarea matInput [formControlName]="formField.formControlName" rows="3"></textarea>
        </mat-form-field>
      }
    }
  </div>
  <div class="form-segment">
    <div class="controls">
      <button mat-flat-button color="warn" type="button" (click)="resetForm()">
        Reset Form
      </button>
      <button mat-stroked-button type="button" (click)="toggleRecording()">
        <mat-icon>mic</mat-icon> {{ speech.isRecording() ? 'Stop' : 'Record' }}
      </button>

      <div class="webcam">
        <div class="webcam-media-container">
          @if (capturedImage) {
            <img class="webcam-image" [src]="imageUrl" width="420" height="360">
          }
          <video #video class="webcam-video" width="420" height="360" autoplay muted></video>
        </div>
        <div class="webcam-controls">
          <button mat-stroked-button type="button" (click)="toggleCamera(video)">
            {{ isCameraActive() ? 'Stop Camera' : 'Start Camera' }}
          </button>
          <button [disabled]="!isCameraActive()" mat-stroked-button type="button" (click)="captureAndAnalyze()">Capture & Analyze</button>
        </div>
      </div>
    </div>
  </div>
</form>

@if (isProcessing()) {
  <div class="processing-overlay">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>
}
